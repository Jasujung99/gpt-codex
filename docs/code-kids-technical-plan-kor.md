# Codex Kids - ì‹œê°ì  ì½”ë”© êµìœ¡ í”Œë«í¼ í†µí•© ê¸°ìˆ  ìƒì„¸ ê¸°íšì„œ

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 í”„ë¡œì íŠ¸ëª…
**Codex Kids** - ì•„ì´ë“¤ì„ ìœ„í•œ ì‹œê°ì  ì½”ë”© í•™ìŠµ í”Œë«í¼

### 1.2 í”„ë¡œì íŠ¸ ëª©ì 
ë°ì´í„°ê³¼í•™ê³¼ ì¸ê³µì§€ëŠ¥ ë¶„ì•¼ë¡œ ì§„ì¶œí•  ì•„ì´ë“¤ì„ ìœ„í•´, ì‹œê°ì  ìš”ì†Œë¥¼ ì ê·¹ í™œìš©í•œ ë‹¨ê³„ë³„ ì½”ë”© êµìœ¡ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤. ë‹¨ìˆœí•œ ì½”ë“œ ì‘ì„±ì„ ë„˜ì–´ì„œ, ì½”ë“œì˜ ë™ì‘ ì›ë¦¬ë¥¼ ê·¸ë¦¼ê³¼ ë„í‘œë¡œ ì´í•´í•˜ê³ , ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ê°„ì˜ ë³€í™˜ì„ í†µí•´ í­ë„“ì€ ì‚¬ê³ ë ¥ì„ ê¸°ë¥¼ ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤.

### 1.3 í•µì‹¬ ê°€ì¹˜
- **ì‹œê°ì  í•™ìŠµ**: ì¶”ìƒì ì¸ ì½”ë”© ê°œë…ì„ êµ¬ì²´ì ì¸ ê·¸ë¦¼ìœ¼ë¡œ ì´í•´
- **ë‹¨ê³„ì  ì„±ì¥**: ê°œì¸ ìˆ˜ì¤€ì— ë§ëŠ” ë§ì¶¤í˜• í•™ìŠµ ê²½ë¡œ
- **ë¯¸ë˜ ì¤€ë¹„**: ë°ì´í„°ê³¼í•™/AI ë¶„ì•¼ë¡œì˜ ìì—°ìŠ¤ëŸ¬ìš´ ì—°ê²°ê³ ë¦¬
- **ì•ˆì „í•œ í™˜ê²½**: ì•„ë™ ê°œì¸ì •ë³´ ë³´í˜¸ ë° ì•ˆì „í•œ í•™ìŠµ í™˜ê²½ ì œê³µ

## 2. ëŒ€ìƒ ì‚¬ìš©ì ë° í˜ë¥´ì†Œë‚˜

### 2.1 ì£¼ìš” ëŒ€ìƒ
- **1ì°¨ ëŒ€ìƒ**: ì´ˆë“±í•™êµ ê³ í•™ë…„ ~ ì¤‘í•™ìƒ (10-15ì„¸)
- **2ì°¨ ëŒ€ìƒ**: êµì‚¬ ë° í•™ë¶€ëª¨ (ê´€ë¦¬ì)
- **íŠ¹ì§•**: ë°ì´í„°ê³¼í•™, ì¸ê³µì§€ëŠ¥ ë¶„ì•¼ì— ê´€ì‹¬ì´ ìˆëŠ” í•™ìŠµì
- **ê¸°ì¡´ ê²½í—˜**: ì½”ë”© ê²½í—˜ ë¬´ê´€ (ì™„ì „ ì´ˆë³´ìë¶€í„° ì¤‘ê¸‰ìê¹Œì§€)

### 2.2 ì‚¬ìš©ì í˜ë¥´ì†Œë‚˜

#### í˜ë¥´ì†Œë‚˜ 1: í˜¸ê¸°ì‹¬ ë§ì€ ë¯¼ì§€ (12ì„¸, ì´ˆë³´ì)
- ìˆ˜í•™ì„ ì¢‹ì•„í•˜ê³  íŒ¨í„´ ì°¾ê¸°ë¥¼ ì¦ê¹€
- ë³µì¡í•œ ì„¤ëª…ë³´ë‹¤ëŠ” ê·¸ë¦¼ê³¼ ì˜ˆì‹œë¥¼ ì„ í˜¸
- ì„±ì·¨ê°ì„ ëŠë‚„ ìˆ˜ ìˆëŠ” ë‹¨ê³„ë³„ í•™ìŠµ ì›í•¨

#### í˜ë¥´ì†Œë‚˜ 2: íƒêµ¬ì ì¸ ì¤€í˜¸ (14ì„¸, ì¤‘ê¸‰ì)
- ì´ë¯¸ ìŠ¤í¬ë˜ì¹˜ë‚˜ ê¸°ì´ˆ íŒŒì´ì¬ ê²½í—˜ ìˆìŒ
- "ì™œ ì´ë ‡ê²Œ ì‘ë™í•˜ëŠ”ê°€?"ì— ëŒ€í•œ ê¹Šì€ ê¶ê¸ˆì¦
- ì—¬ëŸ¬ ì–¸ì–´ì˜ ì°¨ì´ì ê³¼ ê³µí†µì ì— ê´€ì‹¬

#### í˜ë¥´ì†Œë‚˜ 3: ì—´ì •ì ì¸ ê¹€ ì„ ìƒë‹˜ (35ì„¸, êµì‚¬)
- ì •ë³´ êµê³¼ ë‹´ë‹¹ êµì‚¬
- í•™ìƒë“¤ì˜ í•™ìŠµ ì§„ë„ ê´€ë¦¬ í•„ìš”
- í‰ê°€ ë„êµ¬ì™€ ê³¼ì œ ë°°í¬ ê¸°ëŠ¥ ìš”êµ¬

## 3. í•µì‹¬ ê¸°ëŠ¥ ë° ê¸°ìˆ  êµ¬í˜„

### 3.1 ì ì‘í˜• í•™ìŠµ ì‹œìŠ¤í…œ

#### ìˆ˜ì¤€ ì§„ë‹¨ ì‹œìŠ¤í…œ
```python
# í•™ìŠµì ìˆ˜ì¤€ í‰ê°€ ì•Œê³ ë¦¬ì¦˜
class LearnerAssessment:
    def __init__(self):
        self.difficulty_levels = {
            'beginner': {'score_range': (0, 30), 'features': ['visual_blocks', 'step_execution']},
            'elementary': {'score_range': (31, 60), 'features': ['basic_python', 'simple_loops']},
            'intermediate': {'score_range': (61, 80), 'features': ['functions', 'data_structures']},
            'advanced': {'score_range': (81, 100), 'features': ['algorithms', 'optimization']}
        }
    
    def assess_level(self, test_results):
        # ì ì‘í˜• í‰ê°€ ë¡œì§
        score = self.calculate_score(test_results)
        return self.determine_level(score)
```

#### ì´ˆë³´ì ëª¨ë“œ - ê¸°ìˆ  êµ¬í˜„
- **ìŠ¤í† ë¦¬í…”ë§ ì£¼ì„ ìƒì„±ê¸°**
  ```javascript
  // Vue ì»´í¬ë„ŒíŠ¸ ì˜ˆì‹œ
  const CommentGenerator = {
    async generateComment(code) {
      // ë¡œì»¬ ì²˜ë¦¬ ìš°ì„ 
      const localComment = this.getLocalComment(code);
      if (localComment) return localComment;
      
      // ë³µì¡í•œ ì½”ë“œë§Œ AI API í˜¸ì¶œ
      if (this.isComplexCode(code)) {
        return await this.callCodexAPI(code);
      }
    }
  }
  ```

- **ë‹¨ê³„ë³„ ì‹¤í–‰ ì‹œê°í™”**
  ```javascript
  // ì½”ë“œ ì‹¤í–‰ ì‹œê°í™” ì—”ì§„
  class ExecutionVisualizer {
    constructor() {
      this.canvas = document.getElementById('visualization');
      this.ctx = this.canvas.getContext('2d');
    }
    
    visualizeStep(line, variables) {
      // ë³€ìˆ˜ ìƒíƒœë¥¼ ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ í‘œí˜„
      this.animateVariableChange(variables);
      this.highlightCurrentLine(line);
    }
  }
  ```

#### ì¤‘ê¸‰ì ëª¨ë“œ - ì–¸ì–´ ë³€í™˜ ì—”ì§„
```python
# ì–¸ì–´ ê°„ ë³€í™˜ ì„œë¹„ìŠ¤
class CodeTranslator:
    def __init__(self):
        self.translators = {
            ('python', 'javascript'): PythonToJSTranslator(),
            ('javascript', 'python'): JSToPythonTranslator(),
            ('scratch', 'python'): ScratchToPythonTranslator()
        }
    
    def translate(self, code, from_lang, to_lang):
        translator = self.translators.get((from_lang, to_lang))
        if not translator:
            return self.fallback_to_ai(code, from_lang, to_lang)
        return translator.translate(code)
```

### 3.2 ì‹œê°ì  í•™ìŠµ ë„êµ¬ - ìƒì„¸ êµ¬í˜„

#### ì•Œê³ ë¦¬ì¦˜ ì‹œê°í™” ì—”ì§„
```javascript
// D3.js ê¸°ë°˜ ì •ë ¬ ì•Œê³ ë¦¬ì¦˜ ì‹œê°í™”
class SortingVisualizer {
  constructor(containerId) {
    this.svg = d3.select(`#${containerId}`)
      .append('svg')
      .attr('width', 800)
      .attr('height', 400);
    
    this.animationSpeed = 1000; // ms
    this.data = [];
  }
  
  async visualizeBubbleSort(array) {
    this.data = array.map((val, idx) => ({value: val, index: idx}));
    
    for (let i = 0; i < array.length - 1; i++) {
      for (let j = 0; j < array.length - i - 1; j++) {
        // ë¹„êµí•  ìš”ì†Œ í•˜ì´ë¼ì´íŠ¸
        await this.highlightElements([j, j + 1], 'comparing');
        
        if (array[j] > array[j + 1]) {
          // êµí™˜ ì• ë‹ˆë©”ì´ì…˜
          await this.swapElements(j, j + 1);
          [array[j], array[j + 1]] = [array[j + 1], array[j]];
        }
        
        await this.clearHighlight([j, j + 1]);
      }
      // ì •ë ¬ëœ ìš”ì†Œ í‘œì‹œ
      await this.markAsSorted(array.length - i - 1);
    }
  }
  
  async swapElements(i, j) {
    const bars = this.svg.selectAll('.bar');
    const bar1 = bars.filter((d, idx) => idx === i);
    const bar2 = bars.filter((d, idx) => idx === j);
    
    return new Promise(resolve => {
      bar1.transition()
        .duration(this.animationSpeed)
        .attr('x', j * 50)
        .on('end', resolve);
      
      bar2.transition()
        .duration(this.animationSpeed)
        .attr('x', i * 50);
    });
  }
}
```

#### ìë£Œêµ¬ì¡° ì‹œê°í™” - WebGL í™œìš©
```javascript
// Three.js ê¸°ë°˜ íŠ¸ë¦¬ êµ¬ì¡° ì‹œê°í™”
class TreeVisualizer {
  constructor(container) {
    this.scene = new THREE.Scene();
    this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    this.renderer = new THREE.WebGLRenderer();
    
    container.appendChild(this.renderer.domElement);
    this.nodes = new Map();
    this.edges = [];
  }
  
  createNode(value, position) {
    const geometry = new THREE.SphereGeometry(0.5, 32, 32);
    const material = new THREE.MeshPhongMaterial({color: 0x00ff00});
    const sphere = new THREE.Mesh(geometry, material);
    
    sphere.position.copy(position);
    this.scene.add(sphere);
    
    // ë…¸ë“œ ë ˆì´ë¸” ì¶”ê°€
    const label = this.createTextLabel(value);
    label.position.copy(position);
    this.scene.add(label);
    
    this.nodes.set(value, {mesh: sphere, label: label});
  }
  
  animateInsertion(parentValue, childValue, isLeft) {
    const parent = this.nodes.get(parentValue);
    const childPos = new THREE.Vector3(
      parent.mesh.position.x + (isLeft ? -2 : 2),
      parent.mesh.position.y - 2,
      parent.mesh.position.z
    );
    
    // ë…¸ë“œ ìƒì„± ì• ë‹ˆë©”ì´ì…˜
    this.createNode(childValue, childPos);
    this.createEdge(parent.mesh.position, childPos);
  }
}
```

### 3.3 í˜‘ì—… ë° í”„ë¡œì íŠ¸ ê´€ë¦¬

#### Git ì—°ë™ ì‹œìŠ¤í…œ - ê°„ì†Œí™” ë²„ì „
```python
# êµìœ¡ìš© Git ë˜í¼
class EduGit:
    def __init__(self, user_id):
        self.user_id = user_id
        self.repo_path = f"/repos/{user_id}"
        
    def simple_commit(self, files, message):
        """í•™ìƒìš© ê°„ë‹¨í•œ ì»¤ë°‹ ì¸í„°í˜ì´ìŠ¤"""
        # ë³µì¡í•œ Git ëª…ë ¹ì„ ìˆ¨ê¸°ê³  ê°„ë‹¨í•œ API ì œê³µ
        repo = git.Repo(self.repo_path)
        repo.index.add(files)
        
        # ìë™ìœ¼ë¡œ ì˜ë¯¸ìˆëŠ” ì»¤ë°‹ ë©”ì‹œì§€ ìƒì„±
        if not message:
            message = self.generate_commit_message(files)
        
        repo.index.commit(message)
        return self.create_visual_history()
    
    def create_visual_history(self):
        """ì»¤ë°‹ íˆìŠ¤í† ë¦¬ë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„"""
        commits = list(self.repo.iter_commits('main', max_count=10))
        return [{
            'id': c.hexsha[:7],
            'message': c.message,
            'timestamp': c.committed_datetime,
            'changes': self.summarize_changes(c)
        } for c in commits]
```

### 3.4 AI ê¸°ë°˜ ì½”ë“œ ë¶„ì„ ë° í”¼ë“œë°±

#### í•˜ì´ë¸Œë¦¬ë“œ ì½”ë“œ ë¶„ì„ ì‹œìŠ¤í…œ
```python
# FastAPI ì—”ë“œí¬ì¸íŠ¸
from fastapi import FastAPI, BackgroundTasks
from typing import Optional
import asyncio

app = FastAPI()

class CodeAnalyzer:
    def __init__(self):
        self.local_analyzer = LocalCodeAnalyzer()
        self.ai_analyzer = AICodeAnalyzer()
        self.cache = RedisCache()
    
    async def analyze_code(self, code: str, language: str, user_level: str):
        # 1ë‹¨ê³„: ìºì‹œ í™•ì¸
        cache_key = self.generate_cache_key(code, language)
        cached_result = await self.cache.get(cache_key)
        if cached_result:
            return cached_result
        
        # 2ë‹¨ê³„: ë¡œì»¬ ë¶„ì„ (ë¹ ë¥¸ ì‘ë‹µ)
        local_result = await self.local_analyzer.analyze(code, language)
        
        # 3ë‹¨ê³„: ë³µì¡ë„ì— ë”°ë¼ AI ë¶„ì„ ê²°ì •
        if self.needs_ai_analysis(code, user_level):
            # ë¹„ë™ê¸°ë¡œ AI ë¶„ì„ ì‹¤í–‰
            asyncio.create_task(self.enhanced_analysis(code, language, cache_key))
            
        return local_result
    
    async def enhanced_analysis(self, code, language, cache_key):
        """ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìƒì„¸ AI ë¶„ì„ ìˆ˜í–‰"""
        ai_result = await self.ai_analyzer.analyze(code, language)
        await self.cache.set(cache_key, ai_result, expire=3600)

@app.post("/api/analyze")
async def analyze_code(
    code: str,
    language: str,
    user_level: str,
    background_tasks: BackgroundTasks
):
    analyzer = CodeAnalyzer()
    result = await analyzer.analyze_code(code, language, user_level)
    return {
        "immediate_feedback": result,
        "detailed_analysis_pending": analyzer.needs_ai_analysis(code, user_level)
    }
```

## 4. ê¸°ìˆ  ìŠ¤íƒ ë° ì•„í‚¤í…ì²˜ ìƒì„¸

### 4.1 í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜

#### Vue.js 3 + Nuxt.js êµ¬ì¡°
```javascript
// nuxt.config.js
export default {
  ssr: true, // SEO ìµœì í™”
  target: 'server',
  
  modules: [
    '@nuxtjs/pwa', // ì˜¤í”„ë¼ì¸ ì§€ì›
    '@nuxtjs/i18n', // ë‹¤êµ­ì–´ ì§€ì›
    '@nuxtjs/axios',
    '@pinia/nuxt' // ìƒíƒœ ê´€ë¦¬
  ],
  
  buildModules: [
    '@nuxt/typescript-build',
    '@nuxtjs/tailwindcss',
    '@nuxtjs/composition-api/module'
  ],
  
  pwa: {
    manifest: {
      name: 'Codex Kids',
      short_name: 'CK',
      theme_color: '#4F46E5'
    },
    workbox: {
      // ì˜¤í”„ë¼ì¸ ìºì‹± ì „ëµ
      runtimeCaching: [
        {
          urlPattern: 'https://api.codexkids.com/.*',
          handler: 'NetworkFirst',
          options: {
            cacheName: 'api-cache'
          }
        }
      ]
    }
  }
}
```

#### ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°
```typescript
// components/CodeEditor/MonacoEditor.vue
<template>
  <div class="code-editor-container">
    <div ref="editorContainer" class="editor"></div>
    <div v-if="showVisualizer" class="visualizer">
      <component :is="currentVisualizer" :code="code" :execution-state="executionState" />
    </div>
  </div>
</template>

<script setup lang="ts">
import * as monaco from 'monaco-editor'
import { ref, onMounted, watch } from 'vue'
import { useCodeAnalysis } from '@/composables/useCodeAnalysis'

const props = defineProps<{
  language: string
  initialCode: string
  userLevel: 'beginner' | 'intermediate' | 'advanced'
}>()

const editorContainer = ref<HTMLElement>()
const code = ref(props.initialCode)
const { analyzeCode, executionState } = useCodeAnalysis()

let editor: monaco.editor.IStandaloneCodeEditor

onMounted(() => {
  // Monaco Editor ì„¤ì •
  editor = monaco.editor.create(editorContainer.value!, {
    value: code.value,
    language: props.language,
    theme: 'vs-dark',
    minimap: { enabled: false },
    fontSize: 14,
    lineNumbers: props.userLevel !== 'beginner' ? 'on' : 'off',
    glyphMargin: true, // ì¤‘ë‹¨ì  í‘œì‹œìš©
    automaticLayout: true
  })
  
  // ì‹¤ì‹œê°„ ì½”ë“œ ë¶„ì„
  editor.onDidChangeModelContent(debounce(() => {
    code.value = editor.getValue()
    analyzeCode(code.value, props.language)
  }, 500))
  
  // ì´ˆë³´ì ëª¨ë“œ í–¥ìƒ ê¸°ëŠ¥
  if (props.userLevel === 'beginner') {
    setupBeginnerFeatures(editor)
  }
})

function setupBeginnerFeatures(editor: monaco.editor.IStandaloneCodeEditor) {
  // ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ ì„¤ëª… í‘œì‹œ
  monaco.languages.registerHoverProvider(props.language, {
    provideHover: async (model, position) => {
      const word = model.getWordAtPosition(position)
      if (!word) return
      
      const explanation = await getSimpleExplanation(word.word)
      return {
        contents: [{ value: explanation }]
      }
    }
  })
  
  // ìë™ ì™„ì„± ê°„ì†Œí™”
  monaco.languages.registerCompletionItemProvider(props.language, {
    provideCompletionItems: () => {
      return {
        suggestions: getBeginnerSuggestions(props.language)
      }
    }
  })
}
</script>
```

### 4.2 ë°±ì—”ë“œ ì•„í‚¤í…ì²˜

#### FastAPI ì„œë²„ êµ¬ì¡°
```python
# main.py
from fastapi import FastAPI, WebSocket, Depends
from fastapi.middleware.cors import CORSMiddleware
from contextlib import asynccontextmanager
import redis.asyncio as redis
from sqlalchemy.ext.asyncio import create_async_engine

# ì„œë¹„ìŠ¤ ì„í¬íŠ¸
from services.code_analyzer import CodeAnalyzer
from services.visualizer import VisualizationEngine
from services.ai_tutor import AITutor
from services.project_manager import ProjectManager

# ì „ì—­ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
@asynccontextmanager
async def lifespan(app: FastAPI):
    # ì‹œì‘ ì‹œ ë¦¬ì†ŒìŠ¤ ì´ˆê¸°í™”
    app.state.redis = await redis.create_pool("redis://localhost")
    app.state.db_engine = create_async_engine("postgresql+asyncpg://...")
    
    yield
    
    # ì¢…ë£Œ ì‹œ ë¦¬ì†ŒìŠ¤ ì •ë¦¬
    await app.state.redis.close()
    await app.state.db_engine.dispose()

app = FastAPI(lifespan=lifespan)

# CORS ì„¤ì •
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://codexkids.com"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# WebSocket ì—°ê²° ê´€ë¦¬
class ConnectionManager:
    def __init__(self):
        self.active_connections: dict[str, WebSocket] = {}
    
    async def connect(self, websocket: WebSocket, user_id: str):
        await websocket.accept()
        self.active_connections[user_id] = websocket
        
    async def broadcast_to_group(self, group_id: str, message: dict):
        # ê·¸ë£¹ í˜‘ì—…ì„ ìœ„í•œ ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŠ¸
        for user_id, connection in self.active_connections.items():
            if self.is_in_group(user_id, group_id):
                await connection.send_json(message)

manager = ConnectionManager()

# ì‹¤ì‹œê°„ í˜‘ì—… ì—”ë“œí¬ì¸íŠ¸
@app.websocket("/ws/{user_id}")
async def websocket_endpoint(websocket: WebSocket, user_id: str):
    await manager.connect(websocket, user_id)
    try:
        while True:
            data = await websocket.receive_json()
            
            if data["type"] == "code_change":
                # ì½”ë“œ ë³€ê²½ì‚¬í•­ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ì „íŒŒ
                await manager.broadcast_to_group(
                    data["group_id"],
                    {
                        "type": "code_update",
                        "user_id": user_id,
                        "changes": data["changes"]
                    }
                )
            elif data["type"] == "cursor_position":
                # ì»¤ì„œ ìœ„ì¹˜ ê³µìœ  (ì‹¤ì‹œê°„ í˜‘ì—…)
                await manager.broadcast_to_group(
                    data["group_id"],
                    {
                        "type": "cursor_update",
                        "user_id": user_id,
                        "position": data["position"]
                    }
                )
    except WebSocketDisconnect:
        manager.disconnect(user_id)
```

#### ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸
```python
# models/database.py
from sqlalchemy import Column, Integer, String, DateTime, ForeignKey, JSON, Text
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import relationship

Base = declarative_base()

class User(Base):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True)
    email = Column(String(255), unique=True, nullable=False)
    username = Column(String(50), unique=True, nullable=False)
    age_group = Column(String(20))  # 'elementary', 'middle', 'high'
    skill_level = Column(String(20), default='beginner')
    
    # ê´€ê³„
    projects = relationship("Project", back_populates="owner")
    learning_progress = relationship("LearningProgress", back_populates="user")
    
class Project(Base):
    __tablename__ = "projects"
    
    id = Column(Integer, primary_key=True)
    title = Column(String(200), nullable=False)
    description = Column(Text)
    owner_id = Column(Integer, ForeignKey("users.id"))
    language = Column(String(20))
    code_content = Column(JSON)  # ë²„ì „ë³„ ì½”ë“œ ì €ì¥
    visibility = Column(String(20), default='private')
    
    # ê´€ê³„
    owner = relationship("User", back_populates="projects")
    collaborators = relationship("ProjectCollaborator", back_populates="project")
    
class LearningProgress(Base):
    __tablename__ = "learning_progress"
    
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey("users.id"))
    module_id = Column(String(50))
    completion_percentage = Column(Integer, default=0)
    last_accessed = Column(DateTime)
    performance_metrics = Column(JSON)  # ìƒì„¸ ì„±ê³¼ ë°ì´í„°
    
    # ê´€ê³„
    user = relationship("User", back_populates="learning_progress")

class CodeExecution(Base):
    __tablename__ = "code_executions"
    
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey("users.id"))
    code = Column(Text)
    language = Column(String(20))
    execution_time = Column(DateTime)
    result = Column(JSON)
    errors = Column(JSON)
    visualization_data = Column(JSON)  # ì‹œê°í™”ì— í•„ìš”í•œ ë°ì´í„°
```

### 4.3 ë³´ì•ˆ ë° ì„±ëŠ¥ ìµœì í™”

#### ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´
```python
# middleware/security.py
from fastapi import Request, HTTPException
from starlette.middleware.base import BaseHTTPMiddleware
import jwt
import re

class SecurityMiddleware(BaseHTTPMiddleware):
    def __init__(self, app, secret_key: str):
        super().__init__(app)
        self.secret_key = secret_key
        self.rate_limiter = RateLimiter()
        
    async def dispatch(self, request: Request, call_next):
        # 1. ì¸ì¦ í† í° ê²€ì¦
        if not self.is_public_endpoint(request.url.path):
            token = request.headers.get("Authorization")
            if not token or not self.verify_token(token):
                raise HTTPException(status_code=401, detail="Unauthorized")
        
        # 2. Rate Limiting
        client_ip = request.client.host
        if not await self.rate_limiter.is_allowed(client_ip):
            raise HTTPException(status_code=429, detail="Too many requests")
        
        # 3. ì…ë ¥ ê²€ì¦ (ì½”ë“œ ì¸ì ì…˜ ë°©ì§€)
        if request.method == "POST":
            body = await request.body()
            if self.contains_malicious_code(body):
                raise HTTPException(status_code=400, detail="Invalid input")
        
        # 4. ì‘ë‹µ í—¤ë” ë³´ì•ˆ ì„¤ì •
        response = await call_next(request)
        response.headers["X-Content-Type-Options"] = "nosniff"
        response.headers["X-Frame-Options"] = "DENY"
        response.headers["X-XSS-Protection"] = "1; mode=block"
        
        return response
    
    def contains_malicious_code(self, code: bytes) -> bool:
        # ìœ„í—˜í•œ íŒ¨í„´ ê²€ì‚¬
        dangerous_patterns = [
            r'import\s+os',
            r'import\s+subprocess',
            r'__import__',
            r'eval\s*\(',
            r'exec\s*\(',
            r'open\s*\(',
        ]
        
        code_str = code.decode('utf-8', errors='ignore')
        for pattern in dangerous_patterns:
            if re.search(pattern, code_str):
                return True
        return False
```

#### ì„±ëŠ¥ ìµœì í™” - ìºì‹± ì „ëµ
```python
# services/cache_manager.py
from typing import Optional, Any
import json
import hashlib

class CacheManager:
    def __init__(self, redis_client):
        self.redis = redis_client
        self.ttl = {
            'code_analysis': 3600,      # 1ì‹œê°„
            'visualization': 7200,      # 2ì‹œê°„
            'user_progress': 300,       # 5ë¶„
            'static_content': 86400     # 24ì‹œê°„
        }
    
    async def get_or_compute(
        self,
        key: str,
        compute_func,
        category: str = 'default'
    ) -> Any:
        # ìºì‹œ í™•ì¸
        cached = await self.redis.get(key)
        if cached:
            return json.loads(cached)
        
        # ê³„ì‚° ìˆ˜í–‰
        result = await compute_func()
        
        # ìºì‹œ ì €ì¥
        ttl = self.ttl.get(category, 1800)
        await self.redis.setex(
            key,
            ttl,
            json.dumps(result)
        )
        
        return result
    
    def generate_key(self, prefix: str, *args) -> str:
        # ì¼ê´€ëœ ìºì‹œ í‚¤ ìƒì„±
        content = f"{prefix}:" + ":".join(str(arg) for arg in args)
        return hashlib.md5(content.encode()).hexdigest()
```

### 4.4 ì˜¤í”„ë¼ì¸ ì§€ì› êµ¬í˜„

#### Service Worker ì„¤ì •
```javascript
// static/sw.js
const CACHE_NAME = 'codex-kids-v1';
const urlsToCache = [
  '/',
  '/css/main.css',
  '/js/app.js',
  '/offline.html',
  // ê¸°ë³¸ í•™ìŠµ ì½˜í…ì¸ 
  '/api/lessons/basic-python.json',
  '/api/lessons/basic-javascript.json'
];

// ì„¤ì¹˜ ì´ë²¤íŠ¸
self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(urlsToCache))
  );
});

// ìš”ì²­ ê°€ë¡œì±„ê¸°
self.addEventListener('fetch', event => {
  event.respondWith(
    caches.match(event.request)
      .then(response => {
        // ìºì‹œì— ìˆìœ¼ë©´ ìºì‹œ ë°˜í™˜
        if (response) {
          return response;
        }
        
        // ë„¤íŠ¸ì›Œí¬ ìš”ì²­
        return fetch(event.request)
          .then(response => {
            // ë™ì  ìºì‹±
            if (event.request.url.includes('/api/lessons/')) {
              const responseToCache = response.clone();
              caches.open(CACHE_NAME)
                .then(cache => {
                  cache.put(event.request, responseToCache);
                });
            }
            return response;
          })
          .catch(() => {
            // ì˜¤í”„ë¼ì¸ í´ë°±
            if (event.request.destination === 'document') {
              return caches.match('/offline.html');
            }
          });
      })
  );
});

// ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™”
self.addEventListener('sync', event => {
  if (event.tag === 'sync-progress') {
    event.waitUntil(syncUserProgress());
  }
});

async function syncUserProgress() {
  const db = await openDB('codex-kids', 1);
  const tx = db.transaction('pending-progress', 'readonly');
  const pendingData = await tx.objectStore('pending-progress').getAll();
  
  for (const data of pendingData) {
    try {
      await fetch('/api/progress/sync', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      });
      
      // ì„±ê³µí•˜ë©´ ë¡œì»¬ ë°ì´í„° ì‚­ì œ
      await db.delete('pending-progress', data.id);
    } catch (error) {
      console.error('ë™ê¸°í™” ì‹¤íŒ¨:', error);
    }
  }
}
```

## 5. ì‹œê°í™” ì—”ì§„ ìƒì„¸ êµ¬í˜„

### 5.1 ì•Œê³ ë¦¬ì¦˜ ì‹œê°í™” í”„ë ˆì„ì›Œí¬
```typescript
// visualizer/AlgorithmVisualizer.ts
export abstract class AlgorithmVisualizer {
  protected container: HTMLElement;
  protected animationSpeed: number = 1000;
  protected isPaused: boolean = false;
  protected currentStep: number = 0;
  protected steps: VisualizationStep[] = [];
  
  constructor(container: HTMLElement) {
    this.container = container;
    this.setupControls();
  }
  
  abstract async visualize(input: any): Promise<void>;
  
  protected async executeStep(step: VisualizationStep) {
    if (this.isPaused) {
      await this.waitForResume();
    }
    
    // ë‹¨ê³„ë³„ ì‹¤í–‰
    await step.execute();
    
    // ì„¤ëª… í‘œì‹œ
    this.showExplanation(step.explanation);
    
    // ì½”ë“œ í•˜ì´ë¼ì´íŠ¸
    this.highlightCode(step.codeLines);
    
    // ì• ë‹ˆë©”ì´ì…˜ ëŒ€ê¸°
    await this.delay(this.animationSpeed);
  }
  
  protected setupControls() {
    const controls = document.createElement('div');
    controls.className = 'visualizer-controls';
    
    // ì¬ìƒ/ì¼ì‹œì •ì§€ ë²„íŠ¼
    const playPauseBtn = document.createElement('button');
    playPauseBtn.onclick = () => this.togglePause();
    
    // ì†ë„ ì¡°ì ˆ
    const speedSlider = document.createElement('input');
    speedSlider.type = 'range';
    speedSlider.min = '100';
    speedSlider.max = '2000';
    speedSlider.value = String(this.animationSpeed);
    speedSlider.oninput = (e) => {
      this.animationSpeed = parseInt((e.target as HTMLInputElement).value);
    };
    
    controls.appendChild(playPauseBtn);
    controls.appendChild(speedSlider);
    this.container.appendChild(controls);
  }
}

// êµ¬ì²´ì ì¸ êµ¬í˜„ ì˜ˆ: ì´ì§„ íƒìƒ‰ ì‹œê°í™”
export class BinarySearchVisualizer extends AlgorithmVisualizer {
  private array: number[] = [];
  private svg: any; // D3 selection
  
  async visualize(input: {array: number[], target: number}) {
    this.array = input.array;
    this.setupVisualization();
    
    let left = 0;
    let right = this.array.length - 1;
    
    while (left <= right) {
      const mid = Math.floor((left + right) / 2);
      
      // íƒìƒ‰ ë²”ìœ„ í‘œì‹œ
      await this.executeStep({
        execute: async () => {
          this.highlightRange(left, right);
          this.highlightMidpoint(mid);
        },
        explanation: `íƒìƒ‰ ë²”ìœ„: ${left}~${right}, ì¤‘ê°„ê°’: ${mid}`,
        codeLines: [3, 4] // í•´ë‹¹ ì½”ë“œ ë¼ì¸
      });
      
      if (this.array[mid] === input.target) {
        await this.executeStep({
          execute: async () => this.markAsFound(mid),
          explanation: `ì°¾ì•˜ìŠµë‹ˆë‹¤! ì¸ë±ìŠ¤ ${mid}ì— ìˆìŠµë‹ˆë‹¤.`,
          codeLines: [6]
        });
        return;
      }
      
      if (this.array[mid] < input.target) {
        left = mid + 1;
        await this.executeStep({
          execute: async () => this.adjustRange('left', mid + 1),
          explanation: `ì¤‘ê°„ê°’ì´ ì‘ìœ¼ë¯€ë¡œ ì˜¤ë¥¸ìª½ íƒìƒ‰`,
          codeLines: [8, 9]
        });
      } else {
        right = mid - 1;
        await this.executeStep({
          execute: async () => this.adjustRange('right', mid - 1),
          explanation: `ì¤‘ê°„ê°’ì´ í¬ë¯€ë¡œ ì™¼ìª½ íƒìƒ‰`,
          codeLines: [11, 12]
        });
      }
    }
    
    await this.executeStep({
      execute: async () => this.markAsNotFound(),
      explanation: `ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`,
      codeLines: [15]
    });
  }
  
  private highlightRange(left: number, right: number) {
    this.svg.selectAll('.array-element')
      .style('opacity', (d: any, i: number) => 
        i >= left && i <= right ? 1 : 0.3
      );
  }
}
```

### 5.2 ë°ì´í„° ì‹œê°í™” ë„êµ¬
```python
# services/data_visualizer.py
import plotly.graph_objects as go
import pandas as pd
from typing import Dict, Any, List

class DataVisualizer:
    def __init__(self):
        self.theme = {
            'beginner': {
                'colorscale': 'Viridis',
                'font_size': 14,
                'show_grid': True,
                'annotations': True
            },
            'intermediate': {
                'colorscale': 'Plotly3',
                'font_size': 12,
                'show_grid': True,
                'annotations': False
            }
        }
    
    def create_interactive_chart(
        self,
        data: pd.DataFrame,
        chart_type: str,
        user_level: str = 'beginner'
    ) -> Dict[str, Any]:
        """ì‚¬ìš©ì ìˆ˜ì¤€ì— ë§ëŠ” ì¸í„°ë™í‹°ë¸Œ ì°¨íŠ¸ ìƒì„±"""
        
        theme = self.theme[user_level]
        
        if chart_type == 'bar':
            fig = self._create_bar_chart(data, theme)
        elif chart_type == 'scatter':
            fig = self._create_scatter_plot(data, theme)
        elif chart_type == 'line':
            fig = self._create_line_chart(data, theme)
        elif chart_type == 'pie':
            fig = self._create_pie_chart(data, theme)
        else:
            raise ValueError(f"Unsupported chart type: {chart_type}")
        
        # ì´ˆë³´ìë¥¼ ìœ„í•œ ì¶”ê°€ ì„¤ëª…
        if user_level == 'beginner':
            fig.add_annotation(
                text="ğŸ’¡ ê·¸ë˜í”„ë¥¼ í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•´ë³´ì„¸ìš”!",
                xref="paper", yref="paper",
                x=0.5, y=1.1,
                showarrow=False,
                font=dict(size=12, color="gray")
            )
        
        return fig.to_dict()
    
    def _create_bar_chart(self, data: pd.DataFrame, theme: Dict) -> go.Figure:
        fig = go.Figure(data=[
            go.Bar(
                x=data.index,
                y=data.iloc[:, 0],
                text=data.iloc[:, 0],
                textposition='auto',
                marker_color='lightblue',
                hovertemplate='<b>%{x}</b><br>ê°’: %{y}<extra></extra>'
            )
        ])
        
        fig.update_layout(
            title="ë§‰ëŒ€ ê·¸ë˜í”„",
            xaxis_title="í•­ëª©",
            yaxis_title="ê°’",
            font=dict(size=theme['font_size']),
            showlegend=False,
            hovermode='x'
        )
        
        return fig
    
    def create_algorithm_complexity_chart(
        self,
        algorithms: List[str],
        complexities: Dict[str, List[int]]
    ) -> Dict[str, Any]:
        """ì•Œê³ ë¦¬ì¦˜ ë³µì¡ë„ ë¹„êµ ì°¨íŠ¸"""
        
        fig = go.Figure()
        
        n_values = list(range(1, 101))
        
        for algo in algorithms:
            if algo == 'O(1)':
                y_values = [1] * len(n_values)
            elif algo == 'O(log n)':
                y_values = [math.log2(n) for n in n_values]
            elif algo == 'O(n)':
                y_values = n_values
            elif algo == 'O(n log n)':
                y_values = [n * math.log2(n) for n in n_values]
            elif algo == 'O(nÂ²)':
                y_values = [n**2 for n in n_values]
            
            fig.add_trace(go.Scatter(
                x=n_values,
                y=y_values,
                mode='lines',
                name=algo,
                hovertemplate=f'{algo}<br>n=%{{x}}<br>ì—°ì‚°=%{{y:.0f}}<extra></extra>'
            ))
        
        fig.update_layout(
            title="ì•Œê³ ë¦¬ì¦˜ ì‹œê°„ ë³µì¡ë„ ë¹„êµ",
            xaxis_title="ì…ë ¥ í¬ê¸° (n)",
            yaxis_title="ì—°ì‚° íšŸìˆ˜",
            yaxis_type="log",
            hovermode='x unified'
        )
        
        return fig.to_dict()
```

## 6. êµìœ¡ ì½˜í…ì¸  ê´€ë¦¬ ì‹œìŠ¤í…œ

### 6.1 í•™ìŠµ ëª¨ë“ˆ êµ¬ì¡°
```python
# models/learning_module.py
from pydantic import BaseModel
from typing import List, Optional, Dict

class LearningObjective(BaseModel):
    id: str
    description: str
    skills: List[str]
    
class CodeExample(BaseModel):
    language: str
    code: str
    explanation: str
    visualization_type: Optional[str]
    
class Exercise(BaseModel):
    id: str
    title: str
    description: str
    starter_code: str
    test_cases: List[Dict[str, Any]]
    hints: List[str]
    solution: str
    
class LearningModule(BaseModel):
    id: str
    title: str
    description: str
    difficulty: str  # beginner, intermediate, advanced
    estimated_time: int  # minutes
    prerequisites: List[str]
    objectives: List[LearningObjective]
    content_blocks: List[Dict[str, Any]]
    examples: List[CodeExample]
    exercises: List[Exercise]
    
    class Config:
        schema_extra = {
            "example": {
                "id": "python-loops-01",
                "title": "íŒŒì´ì¬ ë°˜ë³µë¬¸ ê¸°ì´ˆ",
                "description": "forì™€ while ë°˜ë³µë¬¸ì„ ë°°ì›Œë´…ì‹œë‹¤",
                "difficulty": "beginner",
                "estimated_time": 30,
                "prerequisites": ["python-basics-01"],
                "objectives": [
                    {
                        "id": "obj-01",
                        "description": "for ë°˜ë³µë¬¸ ì´í•´í•˜ê¸°",
                        "skills": ["iteration", "sequences"]
                    }
                ],
                "content_blocks": [
                    {
                        "type": "text",
                        "content": "ë°˜ë³µë¬¸ì€ ê°™ì€ ì‘ì—…ì„ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤."
                    },
                    {
                        "type": "interactive_example",
                        "example_id": "for-loop-fruits"
                    }
                ],
                "examples": [
                    {
                        "language": "python",
                        "code": "for fruit in ['ì‚¬ê³¼', 'ë°”ë‚˜ë‚˜', 'ë”¸ê¸°']:\n    print(fruit)",
                        "explanation": "ë¦¬ìŠ¤íŠ¸ì˜ ê° ê³¼ì¼ì„ í•˜ë‚˜ì”© ì¶œë ¥í•©ë‹ˆë‹¤",
                        "visualization_type": "step_through"
                    }
                ],
                "exercises": [
                    {
                        "id": "ex-01",
                        "title": "ìˆ«ì ì¶œë ¥í•˜ê¸°",
                        "description": "1ë¶€í„° 10ê¹Œì§€ ì¶œë ¥í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•˜ì„¸ìš”",
                        "starter_code": "# ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”\n",
                        "test_cases": [
                            {"input": "", "expected_output": "1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n"}
                        ],
                        "hints": ["range(1, 11)ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”"],
                        "solution": "for i in range(1, 11):\n    print(i)"
                    }
                ]
            }
        }
```

### 6.2 ì ì‘í˜• í•™ìŠµ ê²½ë¡œ ìƒì„±
```python
# services/adaptive_learning.py
import numpy as np
from typing import List, Dict, Tuple
from collections import defaultdict

class AdaptiveLearningEngine:
    def __init__(self):
        self.skill_graph = self._build_skill_graph()
        self.user_model = {}
        
    def _build_skill_graph(self) -> Dict[str, List[str]]:
        """ê¸°ìˆ  ê°„ ì„ ìˆ˜ ê´€ê³„ ê·¸ë˜í”„ êµ¬ì¶•"""
        return {
            'variables': [],
            'data_types': ['variables'],
            'operators': ['variables'],
            'conditionals': ['operators', 'data_types'],
            'loops': ['conditionals'],
            'functions': ['loops', 'conditionals'],
            'lists': ['loops', 'variables'],
            'dictionaries': ['lists'],
            'classes': ['functions', 'dictionaries'],
            'algorithms': ['functions', 'lists'],
            'data_structures': ['classes', 'algorithms']
        }
    
    def assess_user_skills(self, user_id: str, test_results: Dict[str, float]) -> Dict[str, float]:
        """ì‚¬ìš©ì ê¸°ìˆ  ìˆ˜ì¤€ í‰ê°€"""
        skill_scores = {}
        
        for skill, score in test_results.items():
            # ë² ì´ì§€ì•ˆ ì¶”ì •ì„ ì‚¬ìš©í•œ ì‹¤ë ¥ í‰ê°€
            prior = self.user_model.get(user_id, {}).get(skill, 0.5)
            posterior = self._bayesian_update(prior, score)
            skill_scores[skill] = posterior
        
        self.user_model[user_id] = skill_scores
        return skill_scores
    
    def _bayesian_update(self, prior: float, evidence: float, confidence: float = 0.7) -> float:
        """ë² ì´ì§€ì•ˆ ì—…ë°ì´íŠ¸ë¡œ ì‹¤ë ¥ ì¶”ì •"""
        likelihood = evidence * confidence + prior * (1 - confidence)
        return likelihood
    
    def generate_learning_path(
        self,
        user_id: str,
        target_skills: List[str],
        current_skills: Dict[str, float]
    ) -> List[Tuple[str, List[str]]]:
        """ê°œì¸ ë§ì¶¤í˜• í•™ìŠµ ê²½ë¡œ ìƒì„±"""
        
        path = []
        learned_skills = set(skill for skill, score in current_skills.items() if score > 0.7)
        
        # ëª©í‘œ ê¸°ìˆ ê¹Œì§€ì˜ ìµœë‹¨ ê²½ë¡œ ì°¾ê¸°
        for target in target_skills:
            if target in learned_skills:
                continue
                
            # BFSë¡œ ì„ ìˆ˜ ê³¼ëª© ì°¾ê¸°
            prerequisites = self._find_prerequisites(target, learned_skills)
            
            # ë‚œì´ë„ ìˆœìœ¼ë¡œ ì •ë ¬
            prerequisites.sort(key=lambda x: self._estimate_difficulty(x))
            
            for prereq in prerequisites:
                if prereq not in [p[0] for p in path]:
                    modules = self._get_modules_for_skill(prereq, user_id)
                    path.append((prereq, modules))
            
            # ëª©í‘œ ê¸°ìˆ  ì¶”ê°€
            modules = self._get_modules_for_skill(target, user_id)
            path.append((target, modules))
        
        return path
    
    def _find_prerequisites(self, skill: str, learned: set) -> List[str]:
        """í•„ìš”í•œ ì„ ìˆ˜ ê¸°ìˆ  ì°¾ê¸°"""
        prerequisites = []
        to_check = [skill]
        visited = set()
        
        while to_check:
            current = to_check.pop(0)
            if current in visited:
                continue
            visited.add(current)
            
            if current in self.skill_graph:
                for prereq in self.skill_graph[current]:
                    if prereq not in learned:
                        prerequisites.append(prereq)
                        to_check.append(prereq)
        
        return list(set(prerequisites))
    
    def _get_modules_for_skill(self, skill: str, user_id: str) -> List[str]:
        """ê¸°ìˆ  í•™ìŠµì„ ìœ„í•œ ëª¨ë“ˆ ì¶”ì²œ"""
        user_level = self.user_model.get(user_id, {}).get('level', 'beginner')
        
        # ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•´ë‹¹ ê¸°ìˆ ê³¼ ë ˆë²¨ì— ë§ëŠ” ëª¨ë“ˆ ì¡°íšŒ
        modules = self._query_modules(skill, user_level)
        
        # ì‚¬ìš©ì ì„ í˜¸ë„ì— ë”°ë¼ ì •ë ¬
        preferences = self._get_user_preferences(user_id)
        modules.sort(key=lambda m: self._score_module(m, preferences), reverse=True)
        
        return modules[:3]  # ìƒìœ„ 3ê°œ ëª¨ë“ˆ ë°˜í™˜
```

## 7. ì‹¤ì‹œê°„ í˜‘ì—… ì‹œìŠ¤í…œ

### 7.1 í˜‘ì—… ì„¸ì…˜ ê´€ë¦¬
```typescript
// services/CollaborationService.ts
import { io, Socket } from 'socket.io-client';
import * as Y from 'yjs';
import { WebrtcProvider } from 'y-webrtc';
import { MonacoBinding } from 'y-monaco';

export class CollaborationService {
  private socket: Socket;
  private ydoc: Y.Doc;
  private provider: WebrtcProvider;
  private binding: MonacoBinding | null = null;
  private awareness: any;
  
  constructor(private sessionId: string, private userId: string) {
    this.socket = io('wss://api.codexkids.com');
    this.ydoc = new Y.Doc();
    
    // WebRTC í”¼ì–´ ì—°ê²° ì„¤ì •
    this.provider = new WebrtcProvider(sessionId, this.ydoc, {
      signaling: ['wss://api.codexkids.com/signal'],
      password: null,
      awareness: {
        user: {
          name: this.userId,
          color: this.generateUserColor()
        }
      }
    });
    
    this.awareness = this.provider.awareness;
    this.setupEventListeners();
  }
  
  connectToEditor(editor: any) {
    const yText = this.ydoc.getText('code');
    
    this.binding = new MonacoBinding(
      yText,
      editor.getModel(),
      new Set([editor]),
      this.awareness
    );
    
    // ì»¤ì„œ ìœ„ì¹˜ ê³µìœ 
    this.awareness.on('change', () => {
      this.updateCursors();
    });
  }
  
  private updateCursors() {
    const states = this.awareness.getStates();
    
    states.forEach((state, clientId) => {
      if (clientId !== this.awareness.clientID) {
        const user = state.user;
        const cursor = state.cursor;
        
        if (cursor) {
          this.renderRemoteCursor(user, cursor);
        }
      }
    });
  }
  
  private renderRemoteCursor(user: any, cursor: any) {
    // Monaco Editorì— ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì»¤ì„œ í‘œì‹œ
    const decoration = {
      range: new monaco.Range(
        cursor.line,
        cursor.column,
        cursor.line,
        cursor.column
      ),
      options: {
        className: `remote-cursor-${user.name}`,
        hoverMessage: { value: `${user.name}ì˜ ì»¤ì„œ` },
        afterContentClassName: `remote-cursor-flag-${user.name}`,
        afterContent: user.name.substring(0, 2)
      }
    };
    
    // ê¸°ì¡´ decoration ì—…ë°ì´íŠ¸
    this.updateDecoration(user.name, decoration);
  }
  
  // ìŒì„± ì±„íŒ… ê¸°ëŠ¥
  async startVoiceChat() {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    
    const peer = new SimplePeer({
      initiator: true,
      stream: stream,
      trickle: false
    });
    
    peer.on('signal', (data) => {
      this.socket.emit('voice-signal', {
        sessionId: this.sessionId,
        signal: data
      });
    });
    
    peer.on('stream', (remoteStream) => {
      const audio = new Audio();
      audio.srcObject = remoteStream;
      audio.play();
    });
    
    this.socket.on('voice-signal', (data) => {
      peer.signal(data.signal);
    });
  }
  
  // í™”ë©´ ê³µìœ 
  async shareScreen() {
    const stream = await navigator.mediaDevices.getDisplayMedia({
      video: true,
      audio: false
    });
    
    this.socket.emit('screen-share', {
      sessionId: this.sessionId,
      streamId: stream.id
    });
    
    stream.getVideoTracks()[0].onended = () => {
      this.socket.emit('screen-share-end', {
        sessionId: this.sessionId
      });
    };
  }
  
  // ì½”ë“œ ë¦¬ë·° ê¸°ëŠ¥
  addComment(lineNumber: number, comment: string) {
    const commentData = {
      id: this.generateId(),
      userId: this.userId,
      lineNumber,
      comment,
      timestamp: new Date().toISOString(),
      resolved: false
    };
    
    this.socket.emit('add-comment', {
      sessionId: this.sessionId,
      comment: commentData
    });
  }
  
  private generateUserColor(): string {
    const colors = [
      '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A',
      '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1F5'
    ];
    return colors[Math.floor(Math.random() * colors.length)];
  }
}
```

## 8. í‰ê°€ ë° í”¼ë“œë°± ì‹œìŠ¤í…œ

### 8.1 ìë™ ì½”ë“œ í‰ê°€ê¸°
```python
# services/code_evaluator.py
import ast
import asyncio
from typing import Dict, List, Any, Tuple
import pylint.lint
from io import StringIO
import sys

class CodeEvaluator:
    def __init__(self):
        self.sandbox_executor = SandboxExecutor()
        self.style_checker = StyleChecker()
        self.complexity_analyzer = ComplexityAnalyzer()
        
    async def evaluate_submission(
        self,
        code: str,
        language: str,
        test_cases: List[Dict[str, Any]],
        exercise_id: str
    ) -> Dict[str, Any]:
        """ì œì¶œëœ ì½”ë“œ ì¢…í•© í‰ê°€"""
        
        evaluation_result = {
            'passed': False,
            'score': 0,
            'test_results': [],
            'style_score': 0,
            'complexity_score': 0,
            'feedback': [],
            'suggestions': []
        }
        
        # 1. êµ¬ë¬¸ ê²€ì‚¬
        syntax_check = self.check_syntax(code, language)
        if not syntax_check['valid']:
            evaluation_result['feedback'].append({
                'type': 'error',
                'message': f"êµ¬ë¬¸ ì˜¤ë¥˜: {syntax_check['error']}",
                'line': syntax_check.get('line', 0)
            })
            return evaluation_result
        
        # 2. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰
        test_results = await self.run_test_cases(code, test_cases, language)
        evaluation_result['test_results'] = test_results
        
        passed_tests = sum(1 for t in test_results if t['passed'])
        test_score = (passed_tests / len(test_cases)) * 100
        
        # 3. ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬
        style_result = await self.style_checker.check(code, language)
        evaluation_result['style_score'] = style_result['score']
        evaluation_result['feedback'].extend(style_result['issues'])
        
        # 4. ë³µì¡ë„ ë¶„ì„
        complexity_result = self.complexity_analyzer.analyze(code, language)
        evaluation_result['complexity_score'] = complexity_result['score']
        
        # 5. ì¢…í•© ì ìˆ˜ ê³„ì‚°
        evaluation_result['score'] = self.calculate_final_score(
            test_score,
            style_result['score'],
            complexity_result['score']
        )
        
        evaluation_result['passed'] = evaluation_result['score'] >= 70
        
        # 6. ê°œì„  ì œì•ˆ ìƒì„±
        suggestions = await self.generate_suggestions(
            code,
            test_results,
            style_result,
            complexity_result,
            exercise_id
        )
        evaluation_result['suggestions'] = suggestions
        
        return evaluation_result
    
    def check_syntax(self, code: str, language: str) -> Dict[str, Any]:
        """êµ¬ë¬¸ ê²€ì‚¬"""
        if language == 'python':
            try:
                ast.parse(code)
                return {'valid': True}
            except SyntaxError as e:
                return {
                    'valid': False,
                    'error': str(e),
                    'line': e.lineno
                }
        # ë‹¤ë¥¸ ì–¸ì–´ ì§€ì› ì¶”ê°€
        
    async def run_test_cases(
        self,
        code: str,
        test_cases: List[Dict[str, Any]],
        language: str
    ) -> List[Dict[str, Any]]:
        """ìƒŒë“œë°•ìŠ¤ì—ì„œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰"""
        
        results = []
        for i, test_case in enumerate(test_cases):
            result = await self.sandbox_executor.execute(
                code,
                test_case['input'],
                language,
                timeout=5.0  # 5ì´ˆ ì œí•œ
            )
            
            passed = result['output'].strip() == test_case['expected_output'].strip()
            
            test_result = {
                'test_id': i,
                'passed': passed,
                'input': test_case['input'],
                'expected': test_case['expected_output'],
                'actual': result['output'],
                'error': result.get('error'),
                'execution_time': result.get('execution_time', 0)
            }
            
            if not passed and not result.get('error'):
                # ì°¨ì´ì  ë¶„ì„
                diff = self.analyze_output_difference(
                    test_case['expected_output'],
                    result['output']
                )
                test_result['difference'] = diff
            
            results.append(test_result)
        
        return results
    
    def calculate_final_score(
        self,
        test_score: float,
        style_score: float,
        complexity_score: float
    ) -> float:
        """ê°€ì¤‘ì¹˜ë¥¼ ì ìš©í•œ ìµœì¢… ì ìˆ˜ ê³„ì‚°"""
        weights = {
            'test': 0.6,      # 60%
            'style': 0.2,     # 20%
            'complexity': 0.2  # 20%
        }
        
        return (
            test_score * weights['test'] +
            style_score * weights['style'] +
            complexity_score * weights['complexity']
        )
    
    async def generate_suggestions(
        self,
        code: str,
        test_results: List[Dict],
        style_result: Dict,
        complexity_result: Dict,
        exercise_id: str
    ) -> List[Dict[str, str]]:
        """AI ê¸°ë°˜ ê°œì„  ì œì•ˆ ìƒì„±"""
        
        suggestions = []
        
        # í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ì— ëŒ€í•œ íŒíŠ¸
        failed_tests = [t for t in test_results if not t['passed']]
        if failed_tests:
            hint = await self.generate_test_hint(code, failed_tests[0], exercise_id)
            suggestions.append({
                'type': 'test_hint',
                'title': 'í…ŒìŠ¤íŠ¸ í†µê³¼ íŒíŠ¸',
                'content': hint
            })
        
        # ìŠ¤íƒ€ì¼ ê°œì„  ì œì•ˆ
        if style_result['score'] < 80:
            suggestions.append({
                'type': 'style',
                'title': 'ì½”ë“œ ìŠ¤íƒ€ì¼ ê°œì„ ',
                'content': self.get_style_improvement_tips(style_result['issues'])
            })
        
        # ë³µì¡ë„ ê°œì„  ì œì•ˆ
        if complexity_result['score'] < 70:
            suggestions.append({
                'type': 'complexity',
                'title': 'ì½”ë“œ ë‹¨ìˆœí™”',
                'content': 'ì½”ë“œê°€ ë³µì¡í•©ë‹ˆë‹¤. í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•˜ê±°ë‚˜ ë” ê°„ë‹¨í•œ ë°©ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”.'
            })
        
        # ëª¨ë²” ë‹µì•ˆê³¼ ë¹„êµ
        exemplar = await self.get_exemplar_solution(exercise_id)
        if exemplar and self.is_significantly_different(code, exemplar):
            suggestions.append({
                'type': 'alternative',
                'title': 'ë‹¤ë¥¸ ì ‘ê·¼ ë°©ë²•',
                'content': 'ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œë„ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŒíŠ¸ë¥¼ ì°¸ê³ í•´ë³´ì„¸ìš”!'
            })
        
        return suggestions

class SandboxExecutor:
    """ì•ˆì „í•œ ì½”ë“œ ì‹¤í–‰ í™˜ê²½"""
    
    async def execute(
        self,
        code: str,
        input_data: str,
        language: str,
        timeout: float = 5.0
    ) -> Dict[str, Any]:
        if language == 'python':
            return await self._execute_python(code, input_data, timeout)
        # ë‹¤ë¥¸ ì–¸ì–´ ì§€ì›
    
    async def _execute_python(
        self,
        code: str,
        input_data: str,
        timeout: float
    ) -> Dict[str, Any]:
        """Docker ì»¨í…Œì´ë„ˆì—ì„œ Python ì½”ë“œ ì‹¤í–‰"""
        
        import docker
        import time
        
        client = docker.from_env()
        
        # ì•ˆì „í•œ ì‹¤í–‰ í™˜ê²½ ì„¤ì •
        container_config = {
            'image': 'python:3.9-slim',
            'command': ['python', '-c', code],
            'stdin_open': True,
            'detach': True,
            'mem_limit': '128m',
            'cpu_quota': 50000,  # CPU ì‚¬ìš©ëŸ‰ ì œí•œ
            'network_disabled': True,  # ë„¤íŠ¸ì›Œí¬ ì°¨ë‹¨
            'read_only': True,
            'tmpfs': {'/tmp': 'size=10M,mode=1777'}  # ì„ì‹œ ì“°ê¸° ê³µê°„
        }
        
        try:
            container = client.containers.create(**container_config)
            container.start()
            
            # ì…ë ¥ ì „ë‹¬
            if input_data:
                container.attach_socket().send(input_data.encode())
            
            # ì‹¤í–‰ ì‹œê°„ ì¸¡ì •
            start_time = time.time()
            exit_code = container.wait(timeout=timeout)
            execution_time = time.time() - start_time
            
            # ì¶œë ¥ ìˆ˜ì§‘
            output = container.logs(stdout=True, stderr=False).decode()
            error = container.logs(stdout=False, stderr=True).decode()
            
            return {
                'output': output,
                'error': error if error else None,
                'exit_code': exit_code['StatusCode'],
                'execution_time': execution_time
            }
            
        except Exception as e:
            return {
                'output': '',
                'error': str(e),
                'exit_code': -1,
                'execution_time': timeout
            }
        finally:
            try:
                container.remove(force=True)
            except:
                pass
```

## 9. ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„ ì‹œìŠ¤í…œ

### 9.1 í•™ìŠµ ë¶„ì„ ëŒ€ì‹œë³´ë“œ
```python
# services/analytics.py
from datetime import datetime, timedelta
import pandas as pd
from typing import Dict, List, Any

class LearningAnalytics:
    def __init__(self, db_session):
        self.db = db_session
        
    async def generate_student_report(
        self,
        student_id: str,
        period: str = 'week'
    ) -> Dict[str, Any]:
        """í•™ìƒ ê°œì¸ í•™ìŠµ ë¦¬í¬íŠ¸ ìƒì„±"""
        
        end_date = datetime.now()
        if period == 'week':
            start_date = end_date - timedelta(days=7)
        elif period == 'month':
            start_date = end_date - timedelta(days=30)
        
        # í•™ìŠµ ì‹œê°„ í†µê³„
        study_time = await self.calculate_study_time(student_id, start_date, end_date)
        
        # ì™„ë£Œí•œ ëª¨ë“ˆ
        completed_modules = await self.get_completed_modules(student_id, start_date, end_date)
        
        # ì½”ë“œ ì œì¶œ í†µê³„
        submission_stats = await self.analyze_submissions(student_id, start_date, end_date)
        
        # ì‹¤ë ¥ í–¥ìƒ ì¶”ì´
        skill_progress = await self.track_skill_progress(student_id, start_date, end_date)
        
        # í•™ìŠµ íŒ¨í„´ ë¶„ì„
        learning_patterns = await self.analyze_learning_patterns(student_id)
        
        return {
            'student_id': student_id,
            'period': {
                'start': start_date.isoformat(),
                'end': end_date.isoformat()
            },
            'summary': {
                'total_study_time': study_time['total_minutes'],
                'daily_average': study_time['daily_average'],
                'modules_completed': len(completed_modules),
                'exercises_solved': submission_stats['total_solved'],
                'success_rate': submission_stats['success_rate']
            },
            'skill_progress': skill_progress,
            'learning_patterns': learning_patterns,
            'recommendations': await self.generate_recommendations(student_id, skill_progress)
        }
    
    async def analyze_learning_patterns(self, student_id: str) -> Dict[str, Any]:
        """í•™ìŠµ íŒ¨í„´ ë¶„ì„"""
        
        # ìµœê·¼ 30ì¼ ë°ì´í„°
        sessions = await self.get_learning_sessions(student_id, days=30)
        
        df = pd.DataFrame(sessions)
        
        # ìš”ì¼ë³„ í•™ìŠµ íŒ¨í„´
        df['weekday'] = pd.to_datetime(df['timestamp']).dt.day_name()
        weekday_pattern = df.groupby('weekday')['duration'].mean().to_dict()
        
        # ì‹œê°„ëŒ€ë³„ í•™ìŠµ íŒ¨í„´
        df['hour'] = pd.to_datetime(df['timestamp']).dt.hour
        hourly_pattern = df.groupby('hour')['duration'].mean().to_dict()
        
        # ê°€ì¥ ìƒì‚°ì ì¸ ì‹œê°„ëŒ€
        productive_hours = df.groupby('hour')['score'].mean().nlargest(3).index.tolist()
        
        # í•™ìŠµ ì§€ì†ì„±
        consecutive_days = self.calculate_streak(df)
        
        return {
            'weekday_pattern': weekday_pattern,
            'hourly_pattern': hourly_pattern,
            'productive_hours': productive_hours,
            'current_streak': consecutive_days,
            'preferred_difficulty': self.analyze_difficulty_preference(df)
        }
    
    async def generate_teacher_dashboard(
        self,
        teacher_id: str,
        class_id: str
    ) -> Dict[str, Any]:
        """êµì‚¬ìš© í•™ê¸‰ ì „ì²´ ë¶„ì„ ëŒ€ì‹œë³´ë“œ"""
        
        students = await self.get_class_students(class_id)
        
        # í•™ê¸‰ ì „ì²´ í†µê³„
        class_stats = {
            'total_students': len(students),
            'active_today': 0,
            'average_progress': 0,
            'struggling_students': [],
            'top_performers': []
        }
        
        student_data = []
        for student in students:
            progress = await self.get_student_progress(student['id'])
            student_data.append({
                'id': student['id'],
                'name': student['name'],
                'progress': progress['overall_progress'],
                'last_active': progress['last_active'],
                'current_module': progress['current_module'],
                'help_needed': progress['struggling_topics']
            })
            
            # ì˜¤ëŠ˜ í™œë™í•œ í•™ìƒ
            if progress['last_active'].date() == datetime.now().date():
                class_stats['active_today'] += 1
            
            # ë„ì›€ í•„ìš” í•™ìƒ
            if progress['overall_progress'] < 50:
                class_stats['struggling_students'].append(student['name'])
        
        # í‰ê·  ì§„ë„ìœ¨
        class_stats['average_progress'] = sum(s['progress'] for s in student_data) / len(student_data)
        
        # ìƒìœ„ ìˆ˜í–‰ì
        student_data.sort(key=lambda x: x['progress'], reverse=True)
        class_stats['top_performers'] = [s['name'] for s in student_data[:3]]
        
        # ì£¼ì œë³„ ì´í•´ë„
        topic_mastery = await self.analyze_class_topic_mastery(class_id)
        
        return {
            'class_id': class_id,
            'timestamp': datetime.now().isoformat(),
            'class_stats': class_stats,
            'students': student_data,
            'topic_mastery': topic_mastery,
            'recommendations': self.generate_class_recommendations(topic_mastery)
        }
```

## 10. ì„±ëŠ¥ ìµœì í™” ë° í™•ì¥ì„±

### 10.1 ë¡œë“œ ë°¸ëŸ°ì‹± ë° ìºì‹±
```yaml
# docker-compose.yml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - api1
      - api2
      - api3
  
  api1:
    build: ./backend
    environment:
      - INSTANCE_ID=1
      - REDIS_URL=redis://redis:6379
      - DATABASE_URL=postgresql://user:pass@postgres:5432/codexkids
    depends_on:
      - redis
      - postgres
  
  api2:
    build: ./backend
    environment:
      - INSTANCE_ID=2
      - REDIS_URL=redis://redis:6379
      - DATABASE_URL=postgresql://user:pass@postgres:5432/codexkids
    depends_on:
      - redis
      - postgres
  
  api3:
    build: ./backend
    environment:
      - INSTANCE_ID=3
      - REDIS_URL=redis://redis:6379
      - DATABASE_URL=postgresql://user:pass@postgres:5432/codexkids
    depends_on:
      - redis
      - postgres
  
  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
  
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: codexkids
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  code_executor:
    build: ./sandbox
    privileged: true
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    deploy:
      replicas: 5

volumes:
  redis_data:
  postgres_data:
```

### 10.2 ëª¨ë‹ˆí„°ë§ ì„¤ì •
```python
# monitoring/metrics.py
from prometheus_client import Counter, Histogram, Gauge
import time
from functools import wraps

# ë©”íŠ¸ë¦­ ì •ì˜
request_count = Counter(
    'codexkids_requests_total',
    'Total requests',
    ['method', 'endpoint', 'status']
)

request_duration = Histogram(
    'codexkids_request_duration_seconds',
    'Request duration',
    ['method', 'endpoint']
)

active_users = Gauge(
    'codexkids_active_users',
    'Number of active users'
)

code_executions = Counter(
    'codexkids_code_executions_total',
    'Total code executions',
    ['language', 'status']
)

api_calls = Counter(
    'codexkids_api_calls_total',
    'External API calls',
    ['api_name', 'status']
)

def track_request_metrics(func):
    """API ì—”ë“œí¬ì¸íŠ¸ ë©”íŠ¸ë¦­ ì¶”ì  ë°ì½”ë ˆì´í„°"""
    @wraps(func)
    async def wrapper(*args, **kwargs):
        start_time = time.time()
        
        try:
            result = await func(*args, **kwargs)
            status = 'success'
        except Exception as e:
            status = 'error'
            raise
        finally:
            duration = time.time() - start_time
            
            # ë©”íŠ¸ë¦­ ê¸°ë¡
            request_count.labels(
                method=kwargs.get('request').method,
                endpoint=func.__name__,
                status=status
            ).inc()
            
            request_duration.labels(
                method=kwargs.get('request').method,
                endpoint=func.__name__
            ).observe(duration)
        
        return result
    
    return wrapper

# Grafana ëŒ€ì‹œë³´ë“œ ì„¤ì •
GRAFANA_DASHBOARD = {
    "dashboard": {
        "title": "Codex Kids Monitoring",
        "panels": [
            {
                "title": "Request Rate",
                "targets": [
                    {
                        "expr": "rate(codexkids_requests_total[5m])"
                    }
                ]
            },
            {
                "title": "Response Time",
                "targets": [
                    {
                        "expr": "histogram_quantile(0.95, codexkids_request_duration_seconds)"
                    }
                ]
            },
            {
                "title": "Active Users",
                "targets": [
                    {
                        "expr": "codexkids_active_users"
                    }
                ]
            },
            {
                "title": "Code Execution Success Rate",
                "targets": [
                    {
                        "expr": "rate(codexkids_code_executions_total{status='success'}[5m]) / rate(codexkids_code_executions_total[5m])"
                    }
                ]
            }
        ]
    }
}
```

## 11. ë°°í¬ ë° CI/CD

### 11.1 GitHub Actions ì›Œí¬í”Œë¡œìš°
```yaml
# .github/workflows/deploy.yml
name: Deploy Codex Kids

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: test
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
      
      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r backend/requirements.txt
        pip install pytest pytest-asyncio pytest-cov
    
    - name: Run tests
      env:
        DATABASE_URL: postgresql://postgres:test@localhost/test
        REDIS_URL: redis://localhost:6379
      run: |
        pytest backend/tests --cov=backend --cov-report=xml
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.xml
  
  build-and-deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Build Docker images
      run: |
        docker build -t codexkids/api:${{ github.sha }} ./backend
        docker build -t codexkids/frontend:${{ github.sha }} ./frontend
    
    - name: Push to registry
      env:
        DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
      run: |
        echo $DOCKER_PASSWORD | docker login -u codexkids --password-stdin
        docker push codexkids/api:${{ github.sha }}
        docker push codexkids/frontend:${{ github.sha }}
    
    - name: Deploy to Kubernetes
      env:
        KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }}
      run: |
        echo "$KUBE_CONFIG" | base64 -d > kubeconfig
        export KUBECONFIG=kubeconfig
        
        kubectl set image deployment/api api=codexkids/api:${{ github.sha }}
        kubectl set image deployment/frontend frontend=codexkids/frontend:${{ github.sha }}
        
        kubectl rollout status deployment/api
        kubectl rollout status deployment/frontend
```

### 11.2 Kubernetes ë°°í¬ ì„¤ì •
```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: codexkids-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: codexkids-api
  template:
    metadata:
      labels:
        app: codexkids-api
    spec:
      containers:
      - name: api
        image: codexkids/api:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: codexkids-secrets
              key: database-url
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: codexkids-secrets
              key: redis-url
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5

---
apiVersion: v1
kind: Service
metadata:
  name: codexkids-api
spec:
  selector:
    app: codexkids-api
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8000
  type: LoadBalancer

---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: codexkids-api-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: codexkids-api
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

## 12. ë³´ì•ˆ ê°•í™” ì¡°ì¹˜

### 12.1 ì•„ë™ ê°œì¸ì •ë³´ ë³´í˜¸
```python
# security/child_protection.py
from cryptography.fernet import Fernet
import hashlib
from typing import Dict, Any
import re

class ChildDataProtection:
    def __init__(self, encryption_key: bytes):
        self.cipher = Fernet(encryption_key)
        self.pii_patterns = {
            'phone': re.compile(r'\d{3}-\d{4}-\d{4}'),
            'email': re.compile(r'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'),
            'address': re.compile(r'\d+\s+[\w\s]+(?:street|st|avenue|ave|road|rd|lane|ln)', re.I),
            'korean_rrn': re.compile(r'\d{6}-[1-4]\d{6}')  # ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸
        }
    
    def sanitize_user_data(self, data: Dict[str, Any]) -> Dict[str, Any]:
        """ë¯¼ê°í•œ ê°œì¸ì •ë³´ ì œê±° ë˜ëŠ” ì•”í˜¸í™”"""
        sanitized = data.copy()
        
        # í•„ìˆ˜ ì •ë³´ë§Œ ìœ ì§€
        allowed_fields = ['username', 'age_group', 'school_grade', 'learning_preferences']
        
        # ë¶ˆí•„ìš”í•œ í•„ë“œ ì œê±°
        for key in list(sanitized.keys()):
            if key not in allowed_fields:
                del sanitized[key]
        
        # ì‚¬ìš©ìëª… ê²€ì¦ (ì‹¤ëª… ì‚¬ìš© ê¸ˆì§€)
        if 'username' in sanitized:
            if self._contains_real_name(sanitized['username']):
                sanitized['username'] = self._generate_safe_username()
        
        return sanitized
    
    def encrypt_sensitive_data(self, data: str) -> str:
        """ë¯¼ê°í•œ ë°ì´í„° ì•”í˜¸í™”"""
        return self.cipher.encrypt(data.encode()).decode()
    
    def decrypt_sensitive_data(self, encrypted_data: str) -> str:
        """ì•”í˜¸í™”ëœ ë°ì´í„° ë³µí˜¸í™”"""
        return self.cipher.decrypt(encrypted_data.encode()).decode()
    
    def _contains_real_name(self, username: str) -> bool:
        """ì‹¤ëª… í¬í•¨ ì—¬ë¶€ ê²€ì‚¬"""
        # í•œêµ­ ì„±ì”¨ ëª©ë¡
        korean_surnames = ['ê¹€', 'ì´', 'ë°•', 'ìµœ', 'ì •', 'ê°•', 'ì¡°', 'ìœ¤', 'ì¥', 'ì„']
        
        for surname in korean_surnames:
            if username.startswith(surname):
                return True
        
        # ì˜ë¬¸ ì´ë¦„ íŒ¨í„´
        if re.match(r'^[A-Z][a-z]+\s+[A-Z][a-z]+$', username):
            return True
        
        return False
    
    def _generate_safe_username(self) -> str:
        """ì•ˆì „í•œ ì‚¬ìš©ìëª… ìƒì„±"""
        import random
        
        adjectives = ['ì¦ê±°ìš´', 'ì‹ ë‚˜ëŠ”', 'ë©‹ì§„', 'í™œë°œí•œ', 'ë˜‘ë˜‘í•œ']
        nouns = ['ì½”ë”', 'íƒí—˜ê°€', 'ê°œë°œì', 'ì°½ì‘ì', 'ë°œëª…ê°€']
        
        return f"{random.choice(adjectives)}{random.choice(nouns)}{random.randint(100, 999)}"
    
    def audit_log_access(self, user_id: str, accessed_data: str, purpose: str):
        """ë°ì´í„° ì ‘ê·¼ ê°ì‚¬ ë¡œê·¸"""
        log_entry = {
            'timestamp': datetime.now().isoformat(),
            'user_id': hashlib.sha256(user_id.encode()).hexdigest(),
            'data_type': accessed_data,
            'purpose': purpose,
            'ip_address': self._get_client_ip()
        }
        
        # ê°ì‚¬ ë¡œê·¸ ì €ì¥ (ë³„ë„ ë³´ì•ˆ ìŠ¤í† ë¦¬ì§€)
        self._store_audit_log(log_entry)
```

### 12.2 ì½˜í…ì¸  í•„í„°ë§
```python
# security/content_filter.py
from typing import List, Dict, Tuple
import re

class ContentModerator:
    def __init__(self):
        self.load_filter_lists()
        
    def load_filter_lists(self):
        """ë¶€ì ì ˆí•œ ì½˜í…ì¸  í•„í„° ëª©ë¡ ë¡œë“œ"""
        self.inappropriate_words = set()  # ìš•ì„¤, ë¹„ì†ì–´ ë“±
        self.personal_info_patterns = []  # ê°œì¸ì •ë³´ íŒ¨í„´
        self.suspicious_patterns = []     # ì˜ì‹¬ìŠ¤ëŸ¬ìš´ íŒ¨í„´
        
        # ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” íŒŒì¼ì´ë‚˜ DBì—ì„œ ë¡œë“œ
        
    def moderate_content(
        self,
        content: str,
        content_type: str = 'text'
    ) -> Tuple[bool, List[str]]:
        """ì½˜í…ì¸  ê²€í† """
        issues = []
        
        # í…ìŠ¤íŠ¸ ì½˜í…ì¸  ê²€ì‚¬
        if content_type == 'text':
            # ë¶€ì ì ˆí•œ ì–¸ì–´ ê²€ì‚¬
            if self._contains_inappropriate_language(content):
                issues.append('inappropriate_language')
            
            # ê°œì¸ì •ë³´ í¬í•¨ ê²€ì‚¬
            if self._contains_personal_info(content):
                issues.append('personal_info')
            
            # ì™¸ë¶€ ë§í¬ ê²€ì‚¬
            if self._contains_unsafe_links(content):
                issues.append('unsafe_links')
        
        # ì½”ë“œ ì½˜í…ì¸  ê²€ì‚¬
        elif content_type == 'code':
            if self._contains_malicious_code(content):
                issues.append('malicious_code')
        
        is_safe = len(issues) == 0
        return is_safe, issues
    
    def _contains_inappropriate_language(self, text: str) -> bool:
        """ë¶€ì ì ˆí•œ ì–¸ì–´ í¬í•¨ ì—¬ë¶€ ê²€ì‚¬"""
        text_lower = text.lower()
        
        for word in self.inappropriate_words:
            if word in text_lower:
                return True
        
        return False
    
    def _contains_personal_info(self, text: str) -> bool:
        """ê°œì¸ì •ë³´ í¬í•¨ ì—¬ë¶€ ê²€ì‚¬"""
        # ì „í™”ë²ˆí˜¸ íŒ¨í„´
        if re.search(r'\d{3}-\d{4}-\d{4}', text):
            return True
        
        # ì´ë©”ì¼ íŒ¨í„´
        if re.search(r'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}', text):
            return True
        
        # ì£¼ì†Œ íŒ¨í„´
        if re.search(r'(ì‹œ|êµ¬|ë™|ë¡œ|ê¸¸)\s*\d+', text):
            return True
        
        return False
    
    def _contains_unsafe_links(self, text: str) -> bool:
        """ì•ˆì „í•˜ì§€ ì•Šì€ ë§í¬ í¬í•¨ ì—¬ë¶€ ê²€ì‚¬"""
        # URL ì¶”ì¶œ
        urls = re.findall(r'https?://[^\s]+', text)
        
        safe_domains = [
            'codexkids.com',
            'github.com',
            'python.org',
            'wikipedia.org'
        ]
        
        for url in urls:
            domain = re.search(r'https?://([^/]+)', url)
            if domain:
                domain_name = domain.group(1).lower()
                if not any(safe in domain_name for safe in safe_domains):
                    return True
        
        return False
    
    def _contains_malicious_code(self, code: str) -> bool:
        """ì•…ì„± ì½”ë“œ íŒ¨í„´ ê²€ì‚¬"""
        dangerous_patterns = [
            r'import\s+os',
            r'import\s+subprocess',
            r'import\s+socket',
            r'__import__',
            r'eval\s*\(',
            r'exec\s*\(',
            r'compile\s*\(',
            r'open\s*\([^)]*[\'"]w[\'"]',  # íŒŒì¼ ì“°ê¸°
            r'requests\.(?:get|post)',       # HTTP ìš”ì²­
        ]
        
        for pattern in dangerous_patterns:
            if re.search(pattern, code, re.IGNORECASE):
                return True
        
        return False
```

## 13. ê²°ë¡ 

ì´ í†µí•© ê¸°ìˆ  ìƒì„¸ ê¸°íšì„œëŠ” Codex Kids í”Œë«í¼ì˜ ì „ì²´ì ì¸ ê¸°ìˆ  êµ¬í˜„ ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤. ì£¼ìš” íŠ¹ì§•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **êµìœ¡ íš¨ê³¼ ê·¹ëŒ€í™”**: ì‹œê°ì  í•™ìŠµ ë„êµ¬ì™€ ì ì‘í˜• í•™ìŠµ ì‹œìŠ¤í…œìœ¼ë¡œ ê°œì¸ë³„ ë§ì¶¤ êµìœ¡
2. **ê¸°ìˆ ì  ìš°ìˆ˜ì„±**: ìµœì‹  ì›¹ ê¸°ìˆ ê³¼ AIë¥¼ í™œìš©í•œ í˜ì‹ ì ì¸ í•™ìŠµ ê²½í—˜
3. **ì•ˆì „ì„±**: ì² ì €í•œ ë³´ì•ˆê³¼ ê°œì¸ì •ë³´ ë³´í˜¸ë¡œ ì•ˆì „í•œ í•™ìŠµ í™˜ê²½ ì œê³µ
4. **í™•ì¥ì„±**: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì™€ í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì„¤ê³„ë¡œ ì„±ì¥ ê°€ëŠ¥
5. **ì‹¤ìš©ì„±**: Git ì—°ë™, í”„ë¡œì íŠ¸ ê´€ë¦¬ ë“± ì‹¤ì œ ê°œë°œ í™˜ê²½ê³¼ ìœ ì‚¬í•œ ê²½í—˜ ì œê³µ

ì´ í”Œë«í¼ì„ í†µí•´ ì•„ì´ë“¤ì´ ì¦ê²ê²Œ ì½”ë”©ì„ ë°°ìš°ë©´ì„œë„ ë¯¸ë˜ì˜ ë°ì´í„° ê³¼í•™ìì™€ AI ì „ë¬¸ê°€ë¡œ ì„±ì¥í•  ìˆ˜ ìˆëŠ” íŠ¼íŠ¼í•œ ê¸°ì´ˆë¥¼ ë‹¤ì§ˆ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.
